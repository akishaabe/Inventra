  <main class="forecasting-main">
    <h1 class="page-title">Forecasting</h1>

    <div class="forecasting-content">
      <!-- LEFT PANEL -->
      <div class="left-panel fade-in-delayed">
        <div class="chart-container">
          <canvas #forecastChart></canvas>
        </div>

        <div class="filters">
          <span>
            Forecast Period:
            <select [(ngModel)]="selectedPeriod" (change)="updateForecastPeriod()">
              <option *ngFor="let p of forecastPeriods" [value]="p">Next {{ p }} days</option>
            </select>
          </span>
          <span>
            Product:
            <span class="highlight">{{ forecastData[0]?.product || 'All Products' }}</span>
          </span>
        </div>

        <div class="table-container">
          <h3>DETAILED FORECAST</h3>
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Week(s)</th>
                <th>Prediction</th>
                <th>Current</th>
                <th>Action Needed</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of forecastData | slice:0:tableLimit">
                <td>{{ item.product }}</td>
                <td>
                  <div *ngFor="let week of item.weeks">{{ week }}</div>
                </td>
                <td>
                  <div *ngFor="let pred of item.prediction">{{ pred }}</div>
                </td>
                <td>{{ item.current }}</td>
                <td>{{ item.action }}</td>
              </tr>
            </tbody>
          </table>

          <div *ngIf="forecastData.length > 10" class="show-more">
            <button class="btn-toggle" (click)="toggleTable()">
              {{ tableExpanded ? 'Show Less' : 'Show More' }}
            </button>
          </div>
        </div>
      </div>

      <!-- RIGHT PANEL -->
      <div class="right-panel fade-in-delayed">
        <h3>AI RECOMMENDATIONS FOR TODAY</h3>

        <ng-container *ngIf="groupedRecommendations && groupedRecommendations.length; else noRecs">
          <div class="recommendations-group" *ngFor="let group of groupedRecommendations">
            <div class="group-header" (click)="toggleGroup(group.priority)">
              <h4 [style.color]="getPriorityColor(group.priority)">
                {{ group.priority | titlecase }} ({{ group.items.length }})
              </h4>
              <span class="arrow" [class.open]="group.expanded">â–¾</span>
            </div>

            <div
              class="group-content"
              [class.open]="group.expanded"
              [style.maxHeight]="group.expanded ? '400px' : '0px'"
            >
              <div class="group-scroll">
                <div
                  class="recommendation-card"
                  *ngFor="let rec of group.items"
                  (click)="openRecommendation(rec)"
                >
                  <h4 [style.color]="getPriorityColor(rec.priority)">{{ rec.title }}</h4>
                  <div class="hover-content">
                    <p>{{ rec.description }}</p>
                    <small class="reason-text">{{ rec.subtext }}</small>
                  </div>
                  <div class="action-text">{{ rec.actionText }}</div>
                </div>
              </div>
            </div>
          </div>
        </ng-container>

        <ng-template #noRecs>
          <div class="no-recommendations">No AI recommendations for this period.</div>
        </ng-template>
      </div>
    </div>
  </main>
